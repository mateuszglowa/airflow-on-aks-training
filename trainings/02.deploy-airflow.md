# Hands-on Lab - Day 0
## Exercise 1 - Understanding docker commands

In this exercise, you will pull a couple of Docker images and run them as containers.

The first image will be Nginx. Nginx is a free, open-source web server that can also be used as a reverse proxy, load balancer, and HTTP cache.

The second one will be Apache Tomcat, an open-source implementation of  Java Serverlet and Java Server Pages technologies.

#### Task 1 - login to AKS cluster
```
az login
az account set --subscription 11111111-1111-1111-1111-111111111111
az aks get-credentials --resource-group <Resource Group> --name <ASK NAME> --overwrite-existing
```
#### Task 2 - Check that you connected to cluster by listing all namespaces
```
kubectl get namespaces
```
#### Task 3 - Create namespace for Airflow
```
kubectl create ns airflow
```
#### Task 4 - Crete secret in AKS with ssh public key
```
kubectl crete secret generic airflow-ssh-git-secret --from-file=id_rsa=c:/Users/mat/.ssh/id_rsa --namespace airflow
```
#### Task 5 - Create secret in AKS with redis password
```
kubectl create secret generic airflow-redis -n airflow --from-lireral=redis-password='redis2022'
```
#### Task 6 - Check secrets
```
kubectl describe secrets -n airflow
```

#### Task 7 - Install infress endpoint nginx
```
helm repo update
helm install ingress-nginx ingress-nginx/ingress-nginx --create-namespace --namespace airflow --set controller.service.annotations."service\.beta\.kubernetes\.io/azure-load-balancer-health-probe-request-path"=/healthz
```

#### Task 8 - Check services within airflow namespace
```
kubectl get service -n airflow
kubectl get service ingress-nginx-controller
```

#### Task 9 - Get IP of your public IP
```
az network public-ip list --query "[?ipAddress!=null]|[?contains(ipAddress, 'xx.xx.xx.xx')].[id]"
```

#### Task 10 - update your public Ip Id - associate it with domain
```
az network public-ip update --ids "/subscriptions/xxxx...." --dns-name <DOMAIN NAME>
```
in its output in dnsSettings you can find the fqdn under which you can access airflow UI

// NOW IT SHOULD BE AIRFLOW INSTALLATION


helm install airflow airflow-stable/airflow --namespace airflow --version "8.6.1" --values stable_version.yml
helm upgrade airflow airflow-stable/airflow --namespace airflow --version "8.6.1" --values stable_version.yml

kubectl get pods -n airflow --watch

inside output you can find TIPS which contains Kubernetes Ingress endpoint URLs 